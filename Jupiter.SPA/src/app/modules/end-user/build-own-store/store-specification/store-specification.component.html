<mat-card>
  <form [formGroup]="storeRequestForm">
    <div class="row" style="background-color: #014C98; color: white;">
      <div class="col-md-12" style="
          height: 40px;
          margin: auto;
          display: inline;
          padding: 10px;
          margin-left: 10px;
        ">
        <b>Store Specification</b>
      </div>
    </div>
    <br />
    <div>
      <span class="cardHeader">Art Selected</span>
      <button type="button" class="btn btn-primary addArtBtn" data-toggle="modal" data-target="#addArtModal" style="font-size: 10px;">Add Art URL</button>
      <button type="button" class="btn btn-primary addArtBtn" (click)="uploadArtId.click()" style="font-size: 10px;margin-right: 5px;">
        <span>Upload Art</span>
        <input #uploadArtId type="file" style="display:none;" (change)="uploadArt($event.target.files)" accept="image/*" />
      </button>
    </div>
    <br>
    <mat-card class="artDetailCard">
      <table class="table">
        <thead>
          <tr>
            <th width="5%">SL</th>
            <th width="80%">Art Link</th>
            <th width="10%">Art</th>
            <th width="5%"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let art of artArray; let i = index;">
            <td>{{i + 1}}</td>
            <td>
              <h6 class="disableWordWrap">{{ art.src }}</h6>
            </td>
            <td><img class="artImgHolder" src="{{art.src}}" /></td>
            <td>
              <span class="material-icons" (click)="removeArt(i)" style="cursor: pointer;">
                clear
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </mat-card>
    <br><br>
    <button type="button" class="btn btn-primary addArtBtn" data-toggle="modal" data-target="#addProductModal" style="float: right;font-size: 10px;">
      Add Products
    </button>
    <br>
    <br />
    <div class="row">
      <div class="col-md-12">
        <mat-card>
          <div class="productRow productRowHeader">
            <div class="productCol7">
              <label>Personalize</label>
            </div>
            <div class="productCol7">
              <label>Garment Code</label>
            </div>
            <div class="productCol20">
              <label>Garments Selected</label>
            </div>
            <div class="productCol20">
              <label>Display Name</label>
            </div>
            <div class="productCol7">
              <label>Colors</label>
            </div>
            <div class="productCol7">
              <label>Product Price</label>
            </div>
            <!-- <div class="productCol7">
              <label>Fundraising %</label>
            </div>
            <div class="productCol7">
              <label>Fundraising Amount</label>
            </div> -->
            <!-- <div class="productCol7">
              <label>Discount</label>
            </div> -->
            <!-- <div class="productCol7">
              <label>Total Deco Pricing</label>
            </div> -->
            <div class="productCol7">
              <label>Total Price</label>
            </div>
            <div class="productCol7">
            </div>
          </div>
          <form [formGroup]="storeRequestForm" style="margin-left: -15px;margin-right: -15px;">
            <div formArrayName="garmentsRequested" class="custom-scrollable-wrapper">
              <div class="productRow" style="margin-bottom: 5px;padding-left: 15px;" *ngFor="let garment of storeRequestForm.get('garmentsRequested').controls; let i=index;odd as isOdd; even as isEven" [class.even]="isEven" [class.odd]="isOdd">
                <div class="productCol7 padding-top25" [formGroupName]="i">
                  <mat-checkbox class="example-margin" formControlName="personalize" (change)="updatePersonalize($event,garment.controls.teamStoreGarmentPersonalizations,i)"></mat-checkbox>
                </div>
                <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <input matInput formControlName="productId" type="text" id="{{ i }}" readonly />
                  </mat-form-field>
                </div>
                <div class="productCol20">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <input matInput formControlName="productName" type="text" id="{{ i }}" readonly />
                  </mat-form-field>
                </div>
                <div class="productCol20">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <input matInput formControlName="displayName" type="text" id="{{ i }}" />
                  </mat-form-field>
                </div>
                <div class="productCol7">
                  <mat-form-field class="wrapField common-line-height" [formGroupName]="i">
                    <mat-select formControlName="color">
                      <mat-option *ngFor="let item of productColorArray[i]" [value]="item.id">{{item.name}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <span matPrefix>$&nbsp;</span>
                    <input matInput formControlName="price" type="number" min="0" id="{{ i }}" (change)="getTotal(garment)" readonly />
                  </mat-form-field>
                </div>
                <!-- <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <input matInput formControlName="fundraiserPercentage" type="number" min="0" id="{{ i }}" (change)="getTotal(garment)" />
                    <span matSuffix>%</span>
                  </mat-form-field>
                </div>
                <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <span matPrefix>$&nbsp;</span>
                    <input matInput formControlName="fundraiserAmount" type="number" min="0" id="{{ i }}" (change)="getProductfundraisingPercentage(garment)" />
                  </mat-form-field>
                </div> -->
                <!-- <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <span matPrefix>$&nbsp;</span>
                    <input matInput formControlName="decoPrice" type="number" min="0" id="{{ i }}" readonly />
                  </mat-form-field>
                </div> -->
                <div class="productCol7">
                  <mat-form-field class="common-line-height" [formGroupName]="i">
                    <span matPrefix>$&nbsp;</span>
                    <input matInput formControlName="total" type="number" min="0" id="{{ i }}" readonly />
                  </mat-form-field>
                </div>
                <div class="productCol3" class="padding-top25">
                  <div [formGroupName]="i">
                    <span class="material-icons" (click)="removeProduct(i)" style="cursor: pointer;">
                      clear
                    </span>
                  </div>
                </div>
                <div class="productCol100" style="border: lightgrey solid 1px;" [formGroupName]="i">
                  <div formArrayName="artMapping">
                    <div class="productRow" *ngFor="let artMap of garment.get('artMapping').controls; let j=index">
                      <div class="productCol10">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%;" [formGroupName]="j">
                          <mat-select formControlName="src" [ngStyle]="{'background-image': 'url(' + artMap.get('src').value + ')'}" style="background-repeat: no-repeat;
                          background-size: 40px 40px;height: 30px;">
                            <mat-option *ngFor="let art of artArray; let i  = index" [value]="art.src">
                              <img src={{art.src}} style="height: 60px;width: 60px;border-radius: 20px;padding: 10px;">
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField wrapper12 common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Position</mat-label>
                          <mat-select formControlName="positionId" (selectionChange)="locationSelected(i,j,artMap.controls.positionId.value,artMap,garment,garment.controls.artMapping,i+1)">
                            <mat-option *ngFor="let item of productLocationArray[i]" [value]="item.id" [disabled]="selectedLocationArray[i].indexOf(item.id)>-1">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField wrapper12 common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Service</mat-label>
                          <mat-select formControlName="serviceId" (selectionChange)="getDecoPricing(artMap,j,garment,garment.controls.artMapping,i+1)">
                            <mat-option *ngFor="let item of getDecoServices(i,j)" [value]="item.id">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol7">
                        <mat-form-field class="wrapField wrapper12 common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Color Count</mat-label>
                          <!-- <input matInput formControlName="noOfColors" type="number" min="0" (change)="openAddColorModal(artMap,j,garment,garment.controls.artMapping,i+1)" /> -->
                          <mat-select formControlName="noOfColors"
                            (selectionChange)="openAddColorModal(artMap,j,garment,garment.controls.artMapping,i+1)">
                            <mat-option [value]="1">1</mat-option>
                            <mat-option [value]="2">2</mat-option>
                            <mat-option [value]="3">3</mat-option>
                            <mat-option [value]="4">4</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol35">
                        <mat-form-field class="wrapField wrapper12 common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Colors</mat-label>
                          <input matInput formControlName="colors" readonly (click)="openAddColorModal(artMap,j,garment,garment.controls.artMapping,i+1)" />
                          <span matSuffix>
                            <mat-icon>edit</mat-icon>
                          </span>
                        </mat-form-field>
                      </div>
                      <!-- <div class="productCol10">
                        <mat-form-field class="wrapField wrapper12 common-line-height" [formGroupName]="j">
                          <mat-label>Deco pricing</mat-label>
                          <span matPrefix>$&nbsp;</span>
                          <input matInput formControlName="decoPrice" type="number" min="0" readonly />
                        </mat-form-field>
                      </div> -->
                      <div class="productCol7 padding-top25">
                        <div [formGroupName]="j">
                          <span class="material-icons" (click)="removeArtMapping(garment.controls.artMapping,i,j)" style="cursor: pointer;" *ngIf="garment.get('artMapping').controls.length > 1">
                            clear
                          </span>
                          <span class="material-icons" (click)="addArtMapping(garment.controls.artMapping,garment)" style="cursor: pointer;" *ngIf="garment.get('artMapping').controls.length-1 == j">
                            add
                          </span>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="productCol100" style="border: lightgrey solid 1px;" [formGroupName]="i" *ngIf="garment.get('personalize').value == true">
                  <div formArrayName="teamStoreGarmentPersonalizations">
                    <div class="productRow" *ngFor="let personalize of garment.get('teamStoreGarmentPersonalizations').controls; let j=index">
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Type</mat-label>
                          <mat-select formControlName="personalizedTypeId" (selectionChange)="personalizationTypeSelected(i,personalize,j,garment,garment.controls.teamStoreGarmentPersonalizations)">
                            <mat-option *ngFor="let item of personalizationTypeArray[i]" [value]="item.id" [disabled]="selectedPersonalizationTypeArray[i].indexOf(item.id)>-1">{{item.type}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Location</mat-label>
                          <mat-select formControlName="personalizedLocationId">
                            <mat-option *ngFor="let item of productLocationArray[i]" [value]="item.id">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Service</mat-label>
                          <mat-select formControlName="personalizedServiceId">
                            <mat-option *ngFor="let item of personalizationServiceArray" [value]="item.id">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Color</mat-label>
                          <mat-select formControlName="personalizedColorId">
                            <mat-option *ngFor="let item of colorArray" [value]="item.id">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Size</mat-label>
                          <mat-select formControlName="personalizedSizeId">
                            <mat-option *ngFor="let item of sizeArray?.designsizes" [value]="item.id">{{item.sizeName}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="productCol15">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Font</mat-label>
                          <mat-select formControlName="personalizedFontId">
                            <mat-option *ngFor="let item of fontArray" [value]="item.id">{{item.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <!-- <div class="productCol7">
                        <mat-form-field class="wrapField common-line-height" style="width: 100%" [formGroupName]="j">
                          <mat-label>Price</mat-label>
                          <span matPrefix>$&nbsp;</span>
                          <input matInput formControlName="personalizedCost" type="number" min="0" readonly />
                        </mat-form-field>
                      </div> -->
                      <div class="productCol3 padding-top25">
                        <div [formGroupName]="j">
                          <span class="material-icons" (click)="removepersonalization(garment.controls.teamStoreGarmentPersonalizations,i,j)" style="cursor: pointer;" *ngIf="garment.get('teamStoreGarmentPersonalizations').controls.length > 1">
                            clear
                          </span>
                          <span class="material-icons" (click)="addPersonalization(garment.controls.teamStoreGarmentPersonalizations,garment)" style="cursor: pointer;"
                            *ngIf="garment.get('teamStoreGarmentPersonalizations').controls.length-1 == j && garment.get('teamStoreGarmentPersonalizations').controls.length-1 < 1">
                            add
                          </span>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div><br>
          </form>
        </mat-card>
      </div>
    </div>
    <br />
    <div class="row">
      <div class="col-md-12">
        <mat-form-field class="formField">
          <mat-label>Customer Notes</mat-label>
          <textarea matInput formControlName="customerNotes" cdkTextareaAutosize cdkAutosizeMinRows="5"></textarea>
        </mat-form-field>
        <br />
        <button [disabled]="loading" class="btn btn-primary addArtBtn" style="float: right" (click)="createStore()">
          <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
          To Store Creation<mat-icon class="storeCreationBtn">keyboard_arrow_right</mat-icon>
        </button>
      </div>
    </div>
  </form>
</mat-card>
<div class="modal fade" id="addProductModal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <mat-form-field class="common-line-height" style="width: 100%">
          <mat-label>Product Category</mat-label>
          <mat-select [(ngModel)]="selectedCategory" (selectionChange)="toggleProductList(selectedCategory)">
            <mat-option *ngFor="let category of categoryList" [value]="category.id">{{ category.name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <br />

        <mat-form-field class="common-line-height">
          <mat-label>Product List</mat-label>
          <input type="text" matInput [formControl]="productFormControl" [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="productSelection($event)">
            <mat-option *ngFor="let product of filteredProductList | async" [value]="product.id+' - '+product.name">
              {{product.id+' - '+product.name}}<img src="{{product?.images ? product.images[0] : ''}}" alt="no image" style="height: 40px;width: 40px;border-radius: 20px;;padding-top: 3px; margin-right: 10px; float:right;">
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addArtModal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" (click)="closeArtModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form #form="ngForm">
          <mat-form-field class="common-line-height" style="width: 80%">
            <mat-label>Add Link</mat-label>
            <input type="text" matInput name="name" id="name" [(ngModel)]="imageUrl" />
          </mat-form-field>
          <button type="button" class="btn addArtBtn" (click)="addImageLink(imageUrl)">
            Add link
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addColorModal" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <form #form="ngForm">
          <mat-form-field style="width: 80%" class="common-line-height">
            <mat-label>Colors</mat-label>
            <mat-select [formControl]="selectedArtColors" multiple #colorSelect
            (selectionChange)="onColorSelectionChange($event)">
              <mat-select-trigger>
                <mat-chip-list>
                  <mat-chip *ngFor="let color of selectedArtColors.value" [removable]="true" (removed)="onArtColorRemoved(color)">
                    {{ color.name }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                  </mat-chip>
                </mat-chip-list>
              </mat-select-trigger>
              <mat-option [value]='color' *ngFor="let color of colorArray">{{color.name}}</mat-option>
            </mat-select>
          </mat-form-field>
          <button type="button" class="btn addArtBtn" (click)="updateArtColor()">
            Update
          </button>
          <button class="btn btn-danger btn-sm float-right mr-2" data-dismiss="modal"> Cancel </button>
        </form>
      </div>
    </div>
  </div>
</div>
